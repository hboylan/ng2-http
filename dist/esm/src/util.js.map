{"version":3,"sources":["../../../src/util.ts"],"names":[],"mappings":"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","file":"util.js","sourceRoot":"","sourcesContent":["import {\n  URLSearchParams,\n  Headers as AngularHeaders,\n  RequestOptions,\n  Request\n} from '@angular/http';\nimport {Observable} from 'rxjs/Observable';\nimport {RESTClient} from './rest.service';\nimport 'rxjs/add/operator/mergeMap';\n\n\n// Store request parameters\nexport function param(paramName: string) {\n  return function(key: string) {\n    return function(target: RESTClient, propertyKey: string | symbol, parameterIndex: number) {\n      var metadataKey = `${propertyKey}_${paramName}_parameters`;\n      var paramObj: any = {\n        key: key,\n        parameterIndex: parameterIndex\n      };\n      if (Array.isArray(target[metadataKey])) {\n        target[metadataKey].push(paramObj);\n      } else {\n        target[metadataKey] = [paramObj];\n      }\n    };\n  };\n}\n\n  // perform HTTP request\nexport function method(method: number) {\n  return function(url: string) {\n    return function(target: RESTClient, propertyKey: string, descriptor: any) {\n\n      var pPath = target[`${propertyKey}_Path_parameters`];\n      var pQuery = target[`${propertyKey}_Query_parameters`];\n      var pBody = target[`${propertyKey}_Body_parameters`];\n      var pHeader = target[`${propertyKey}_Header_parameters`];\n\n      descriptor.value = function(...args: any[]) {\n\n        // Path\n        var resUrl: string = url;\n        if (pPath) {\n          for (var k in pPath) {\n            if (pPath.hasOwnProperty(k)) {\n              resUrl = resUrl.replace('{' + pPath[k].key + '}', args[pPath[k].parameterIndex]);\n            }\n          }\n        }\n\n        // Query\n        var search = new URLSearchParams();\n        if (pQuery) {\n          pQuery\n          .filter(p => args[p.parameterIndex]) // filter out optional parameters\n          .forEach(p => {\n            var key = p.key;\n            var value = args[p.parameterIndex];\n            // if the value is a instance of Object, we stringify it\n            if (value instanceof Object) {\n              value = JSON.stringify(value);\n            }\n            search.set(key, value);\n          });\n        }\n\n        // Headers\n        // set class default headers\n        var headers = new AngularHeaders(this.getDefaultHeaders());\n        // set method specific headers\n        for (let j in descriptor.headers) {\n            if (descriptor.headers.hasOwnProperty(j)) {\n                headers.append(j, descriptor.headers[j]);\n            }\n        }\n        // set parameter specific headers\n        if (pHeader) {\n          for (let k in pHeader) {\n            if (pHeader.hasOwnProperty(k)) {\n              headers.append(pHeader[k].key, args[pHeader[k].parameterIndex]);\n            }\n          }\n        }\n\n        // Body\n        var urlencoded = headers.get('Content-Type');\n        var body = null;\n        if (pBody) {\n          if (urlencoded && urlencoded === 'application/x-www-form-urlencoded') {\n            body = args[pBody[0].parameterIndex];\n          } else {\n            body = JSON.stringify(args[pBody[0].parameterIndex]);\n          }\n        }\n\n        // Request options\n        var options = new RequestOptions({\n          method,\n          url: this.getBaseUrl() + resUrl,\n          headers,\n          body,\n          search,\n          withCredentials: this.withCredentials\n        });\n\n        // intercept the request\n        return this.requestInterceptor(new Request(options))\n          .mergeMap(req => {\n\n            // make the request and store the observable for later transformation\n            var observable: Observable<any> = this.http.request(req);\n\n            // global response interceptor\n            observable = this.responseInterceptor(observable);\n\n            // transform the obserable in accordance to the @Produces decorator\n            if (descriptor.producer) {\n              observable = observable.map(descriptor.producer);\n            }\n\n            return observable;\n          });\n      };\n\n      return descriptor;\n    };\n  };\n}\n"]}